# 管理後台架構 (ADMIN_ARCHITECTURE.md)

## 系統架構

```
┌─────────────────────────────────────────────────────────────────────┐
│                      Admin Dashboard (Nuxt.js 3)                    │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐               │
│  │   客戶管理   │  │   情境模板   │  │   收費管理   │               │
│  └─────────────┘  └─────────────┘  └─────────────┘               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐               │
│  │   數據分析   │  │   系統設定   │  │   審計日誌   │               │
│  └─────────────┘  └─────────────┘  └─────────────┘               │
└────────────────────────────┬──────────────────────────────────────┘
                             │ HTTPS (REST API)
                             ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         Backend API Gateway                           │
│                    (Authentication & Authorization)                  │
└────────────────────────────┬──────────────────────────────────────┘
                             │
         ┌───────────────────┼───────────────────┐
         ▼                   ▼                   ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│   Admin User    │ │  User Service   │ │  Scenario       │
│   Service       │ │                 │ │  Service        │
├─────────────────┤ ├─────────────────┤ ├─────────────────┤
│ - Login         │ │ - CRUD          │ │ - CRUD          │
│ - Permissions   │ │ - Subscriptions │ │ - Templates     │
│ - Audit Logs    │ │ - Devices       │ │ - Dialogues     │
└─────────────────┘ └─────────────────┘ └─────────────────┘
         │                   │                   │
         ▼                   ▼                   ▼
┌─────────────────────────────────────────────────────────────────────┐
│                           Data Layer                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐            │
│  │   MySQL 8    │  │     Redis     │  │   MongoDB    │            │
│  │  (Admin)     │  │   (Cache)    │  │   (Logs)     │            │
│  └──────────────┘  └──────────────┘  └──────────────┘            │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 管理後台結構

```
admin/
├── backend/                    # 管理後端 API
│   ├── src/
│   │   ├── main.rs            # 入口
│   │   ├── lib.rs
│   │   ├── config.rs          # 配置
│   │   ├── auth/             # 管理員認證
│   │   │   ├── mod.rs
│   │   │   ├── jwt.rs
│   │   │   └── middleware.rs
│   │   ├── users/            # 用戶管理
│   │   │   ├── mod.rs
│   │   │   ├── handler.rs
│   │   │   └── service.rs
│   │   ├── customers/        # 客戶管理
│   │   │   ├── mod.rs
│   │   │   ├── handler.rs
│   │   │   └── service.rs
│   │   ├── scenarios/        # 情境管理
│   │   │   ├── mod.rs
│   │   │   ├── handler.rs
│   │   │   └── service.rs
│   │   ├── subscriptions/    # 訂閱管理
│   │   │   ├── mod.rs
│   │   │   ├── handler.rs
│   │   │   └── service.rs
│   │   ├── analytics/        # 數據分析
│   │   │   ├── mod.rs
│   │   │   ├── handler.rs
│   │   │   └── service.rs
│   │   ├── settings/         # 系統設定
│   │   │   ├── mod.rs
│   │   │   ├── handler.rs
│   │   │   └── service.rs
│   │   └── audit/           # 審計日誌
│   │       ├── mod.rs
│   │       ├── handler.rs
│   │       └── service.rs
│   ├── Cargo.toml
│   └── migrations/
│       └── admin_*.sql
│
└── web/                       # 管理後台前端 (Nuxt.js 3)
    ├── src/
    │   ├── app.vue
    │   ├── layouts/
    │   │   └── admin.vue    # 管理後台 layout
    │   ├── pages/
    │   │   ├── index.vue   # 儀表板
    │   │   ├── login.vue   # 登入頁
    │   │   ├── users/      # 用戶管理
    │   │   ├── customers/  # 客戶管理
    │   │   ├── scenarios/  # 情境管理
    │   │   ├── subscriptions/ # 訂閱管理
    │   │   ├── analytics/  # 數據分析
    │   │   ├── settings/   # 系統設定
    │   │   └── audit/     # 審計日誌
    │   ├── components/
    │   │   ├── common/    # 通用元件
    │   │   ├── charts/    # 圖表元件
    │   │   └── tables/    # 表格元件
    │   ├── composables/   # Composition API
    │   ├── stores/        # Pinia 狀態管理
    │   ├── types/         # TypeScript 類型
    │   └── utils/         # 工具函數
    ├── nuxt.config.ts
    ├── tailwind.config.js
    └── package.json
```

---

## 功能模組

### 1. 客戶管理 (Customers)

| 功能 | 描述 |
|------|------|
| 客戶列表 | 顯示所有客戶基本資訊 |
| 客戶詳情 | 查看客戶完整資料 |
| 訂閱管理 | 客戶訂閱狀態、方案升級/降級 |
| 設備管理 | 查看客戶設備使用情況 |
| 錯誤記錄 | 查看客戶練習錯誤記錄 |
| 練習記錄 | 查看客戶練習歷史 |

### 2. 情境模板 (Scenarios)

| 功能 | 描述 |
|------|------|
| 模板列表 | 顯示所有情境模板 |
| 模板編輯 | 新增/修改/刪除模板 |
| 對話設計 | 設計對話流程 |
| 角色管理 | 設定角色對話 |
| 預覽 | 預覽情境效果 |
| 發布/下架 | 控制情境上線狀態 |

### 3. 收費管理 (Subscriptions)

| 功能 | 描述 |
|------|------|
| 方案管理 | 新增/修改/刪除訂閱方案 |
| 訂閱列表 | 所有訂閱記錄 |
| 支付記錄 | 支付歷史查詢 |
| 退款處理 | 申請/審批退款 |
| 優惠碼管理 | 優惠碼新增/發放 |
| 收入統計 | 收入報表 |

### 4. 數據分析 (Analytics)

| 功能 | 描述 |
|------|------|
| 使用統計 | DAU/MAU/新用戶 |
| 訂閱轉化 | 免費→付費轉化率 |
| 收入報表 | 每日/每月收入 |
| 留存分析 | 用戶留存率 |
| 錯誤分析 | 常見錯誤統計 |
| 情境熱度 | 情境使用排行 |

### 5. 系統設定 (Settings)

| 功能 | 描述 |
|------|------|
| 角色設定 | 6 種角色管理 |
| 分類設定 | 情境分類管理 |
| 難度設定 | 難度等級管理 |
| 參數設定 | AI 評估參數 |
| 系統參數 | 試用天數等 |
| 服務商設定 | STT/TTS/AI API 設定 |

### 6. 審計日誌 (Audit Logs)

| 功能 | 描述 |
|------|------|
| 操作日誌 | 管理員操作記錄 |
| 登入日誌 | 管理員登入記錄 |
| API 調用日誌 | API 使用記錄 |
| 異常報告 | 系統異常列表 |

---

## 權限控制

| 角色 | 權限 |
|------|------|
| **超級管理員** | 全部權限 |
| **系統管理員** | 除用戶刪除外的全部 |
| **客服人員** | 客戶管理、訂閱管理 |
| **內容管理員** | 情境模板管理 |
| **分析人員** | 數據分析唯讀 |
| **財務人員** | 收費管理、收入統計 |

---

## 技術架構

### 前端 (Nuxt.js 3)

| 項目 | 技術 |
|------|------|
| Framework | Nuxt.js 3 |
| UI 框架 | Element Plus + TailwindCSS |
| 狀態管理 | Pinia |
| 圖表 | ECharts |
| HTTP | $fetch / ofetch |
| 表單驗證 | Zod |

### 後端 (Rust + Axum)

| 項目 | 技術 |
|------|------|
| Web Framework | Axum |
| ORM | SQLx |
| 資料庫 | MySQL 8 |
| 快取 | Redis |
| 認證 | JWT |
| 權限 | RBAC |

---

## 部署

```
Production:
├── admin.nicespeak.app (Nuxt.js Static)
├── api-admin.nicespeak.app (Rust Axum)
└── 資料庫: MySQL 8 (admin schema)
```

---

**版本**: v1.0.0  
**建立日期**: 2024-XX-XX
