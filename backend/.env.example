# Nice Speak - 環境配置文件

## 環境說明

| 環境 | 代號 | 用途 |
|------|------|------|
| Development | dev | 本機開發 |
| Testing | test | 測試環境 |
| Pre-production | pp | 上線前驗證 |
| Production | prod | 正式環境 |

---

## 資料庫命名規則

```
{專案名}_{環境}

範例:
- MySQL: nice_speak_dev, nice_speak_test, nice_speak_pp, nice_speak_prod
- Redis:  (使用 key prefix 區隔)
- MongoDB: nice_speak_dev, nice_speak_test, nice_speak_pp, nice_speak_prod
```

---

## 環境變數模板

複製此檔案為 `.env.{環境}`，例如：
- `.env.dev` - 開發環境
- `.env.test` - 測試環境
- `.env.pp` - 預發布環境
- `.env.prod` - 正式環境

---

## 跳板機資料庫連線

| 服務 | Host | Port | 預設帳號 |
|------|------|------|----------|
| MySQL | 103.251.113.34 | 31001 | root |
| Redis | 103.251.113.34 | 31002 | - |
| MongoDB | 103.251.113.34 | 31003 | admin |

---

## 環境配置範例 (.env.dev)

```bash
# ===========================================
# Nice Speak - 開發環境配置 (.env.dev)
# ===========================================

# 應用配置
APP_ENV=dev
APP_NAME="Nice Speak Dev"
APP_URL=http://localhost:3000

# ===========================================
# 資料庫配置 (跳板機)
# ===========================================
DATABASE_TYPE=mysql

# MySQL 8
MYSQL_HOST=103.251.113.34
MYSQL_PORT=31001
MYSQL_DATABASE=nice_speak_dev
MYSQL_USER=root
MYSQL_PASSWORD=your_password_here

# Redis
REDIS_HOST=103.251.113.34
REDIS_PORT=31002
REDIS_PASSWORD=
REDIS_DB=0
REDIS_KEY_PREFIX=nice_speak:dev:

# MongoDB
MONGODB_URI=mongodb://admin:your_password@103.251.113.34:31003
MONGODB_DATABASE=nice_speak_dev

# ===========================================
# JWT 認證配置
# ===========================================
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=86400
JWT_REFRESH_EXPIRES_IN=604800

# ===========================================
# 外部服務 (預設值，可根據環境調整)
# ===========================================

# STT 服務
STT_PROVIDER=google
STT_API_KEY=your_stt_api_key
STT_LANGUAGE=zh-TW

# TTS 服務
TTS_PROVIDER=azure
TTS_API_KEY=your_tts_api_key
TTS_VOICE=en-US-JennyNeural

# AI 評估服務
AI_PROVIDER=openai
AI_API_KEY=your_ai_api_key
AI_MODEL=gpt-4

# 支付服務
PAYMENT_PROVIDER=ecpay
PAYMENT_MERCHANT_ID=your_merchant_id
PAYMENT_HASH_KEY=your_hash_key
PAYMENT_HASH_IV=your_hash_iv

# ===========================================
# 日誌配置
# ===========================================
LOG_LEVEL=debug
LOG_FORMAT=json

# ===========================================
# 快取配置
# ===========================================
CACHE_TTL=3600
CACHE_MAX_SIZE=10000

# ===========================================
# 速率限制
# ===========================================
RATE_LIMIT_WINDOW=60
RATE_LIMIT_MAX=100
```

---

## 環境配置範例 (.env.test)

```bash
# ===========================================
# Nice Speak - 測試環境配置 (.env.test)
# ===========================================

APP_ENV=test
APP_NAME="Nice Speak Test"
APP_URL=http://test.local:3000

# ===========================================
# 資料庫配置 (跳板機)
# ===========================================
DATABASE_TYPE=mysql

MYSQL_HOST=103.251.113.34
MYSQL_PORT=31001
MYSQL_DATABASE=nice_speak_test
MYSQL_USER=root
MYSQL_PASSWORD=your_password_here

REDIS_HOST=103.251.113.34
REDIS_PORT=31002
REDIS_PASSWORD=
REDIS_DB=0
REDIS_KEY_PREFIX=nice_speak:test:

MONGODB_URI=mongodb://admin:your_password@103.251.113.34:31003
MONGODB_DATABASE=nice_speak_test

# ===========================================
# JWT 認證配置
# ===========================================
JWT_SECRET=your-test-jwt-secret
JWT_EXPIRES_IN=86400
JWT_REFRESH_EXPIRES_IN=604800

# ===========================================
# 日誌配置
# ===========================================
LOG_LEVEL=info
```

---

## 環境配置範例 (.env.pp)

```bash
# ===========================================
# Nice Speak - 預發布環境配置 (.env.pp)
# ===========================================

APP_ENV=pp
APP_NAME="Nice Speak PP"
APP_URL=https://pp.nicespeak.app

# ===========================================
# 資料庫配置 (跳板機)
# ===========================================
DATABASE_TYPE=mysql

MYSQL_HOST=103.251.113.34
MYSQL_PORT=31001
MYSQL_DATABASE=nice_speak_pp
MYSQL_USER=root
MYSQL_PASSWORD=your_password_here

REDIS_HOST=103.251.113.34
REDIS_PORT=31002
REDIS_PASSWORD=
REDIS_DB=0
REDIS_KEY_PREFIX=nice_speak:pp:

MONGODB_URI=mongodb://admin:your_password@103.251.113.34:31003
MONGODB_DATABASE=nice_speak_pp

# ===========================================
# JWT 認證配置
# ===========================================
JWT_SECRET=your-pp-jwt-secret
JWT_EXPIRES_IN=86400
JWT_REFRESH_EXPIRES_IN=604800

# ===========================================
# 日誌配置
# ===========================================
LOG_LEVEL=info
```

---

## 環境配置範例 (.env.prod)

```bash
# ===========================================
# Nice Speak - 正式環境配置 (.env.prod)
# ===========================================

APP_ENV=prod
APP_NAME="Nice Speak"
APP_URL=https://nicespeak.app

# ===========================================
# 資料庫配置 (跳板機)
# ===========================================
DATABASE_TYPE=mysql

MYSQL_HOST=103.251.113.34
MYSQL_PORT=31001
MYSQL_DATABASE=nice_speak_prod
MYSQL_USER=root
MYSQL_PASSWORD=YOUR_SECURE_PASSWORD_HERE

REDIS_HOST=103.251.113.34
REDIS_PORT=31002
REDIS_PASSWORD=YOUR_REDIS_PASSWORD
REDIS_DB=0
REDIS_KEY_PREFIX=nice_speak:prod:

MONGODB_URI=mongodb://admin:YOUR_PASSWORD@103.251.113.34:31003
MONGODB_DATABASE=nice_speak_prod

# ===========================================
# JWT 認證配置 (重要：請更換為強密鑰)
# ===========================================
JWT_SECRET=YOUR_VERY_STRONG_JWT_SECRET_MIN_32_CHARS
JWT_EXPIRES_IN=86400
JWT_REFRESH_EXPIRES_IN=604800

# ===========================================
# 生產環境專用配置
# ===========================================
LOG_LEVEL=warn
ENABLE_CORS=true
ENABLE_RATE_LIMIT=true
```

---

## 使用說明

### 1. 建立環境檔案

```bash
# 複製模板並修改
cp .env.example .env.dev

# 編輯配置
nano .env.dev
```

### 2. 載入環境變數

```bash
# Linux/macOS
export $(cat .env.dev | xargs)

# 或使用 dotenv
source .env.dev
```

### 3. 執行時指定環境

```bash
# 開發環境
APP_ENV=dev cargo run

# 測試環境
APP_ENV=test cargo run
```

---

## 跳板機 SSH 連線 (參考)

```bash
# SSH 連線跳板機
ssh -p 22022 admin@103.251.113.34

# 跳板機連線資料庫 (範例)
mysql -h 103.251.113.34 -P 31001 -u root -p nice_speak_dev
redis-cli -h 103.251.113.34 -p 31002
mongosh "mongodb://admin:password@103.251.113.34:31003/nice_speak_dev"
```

---

## 安全提醒

⚠️ **重要：**
1. `.env` 檔案**不要**提交到 Git
2. 生產環境密鑰**必須**更換
3. 資料庫密碼**不要**寫在程式碼中
4. 使用 `.gitignore` 排除環境檔案

```bash
# .gitignore
.env*
!.env.example
```
